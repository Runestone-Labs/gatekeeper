# Runestone Gatekeeper Policy Configuration
#
# Each tool has a decision: allow | approve | deny
# - allow: Execute immediately
# - approve: Require human approval via Slack
# - deny: Block execution
#
# Additional constraints can be configured per tool.

tools:
  # Shell command execution
  shell.exec:
    decision: approve

    # Regex patterns to deny (matched against canonicalized args)
    deny_patterns:
      - "rm -rf"
      - "rm -r /"
      - "curl.*\\|.*sh"
      - "wget.*\\|.*sh"
      - "chmod 777"
      - "sudo"
      - "eval"
      - "> /dev/"

    # Allowed working directories (prefix match)
    allowed_cwd_prefixes:
      - "/tmp/"
      - "./data/"
      - "./output/"

    # Limits
    max_output_bytes: 1048576   # 1MB
    max_timeout_ms: 30000       # 30 seconds

  # File writing
  files.write:
    decision: approve

    # Allowed paths (prefix match)
    allowed_paths:
      - "/tmp/"
      - "./data/"
      - "./output/"

    # Denied file extensions
    deny_extensions:
      - ".env"
      - ".pem"
      - ".key"
      - ".crt"
      - ".p12"
      - ".pfx"
      - ".jks"

    # Limits
    max_size_bytes: 10485760    # 10MB

  # HTTP requests
  http.request:
    decision: allow

    # Allowed HTTP methods
    allowed_methods:
      - GET
      - POST

    # Blocked domains
    deny_domains:
      - pastebin.com
      - bit.ly
      - tinyurl.com
      - gist.github.com

    # SSRF protection: blocked IP ranges (CIDR notation)
    deny_ip_ranges:
      - "127.0.0.0/8"      # Loopback
      - "10.0.0.0/8"       # Private Class A
      - "172.16.0.0/12"    # Private Class B
      - "192.168.0.0/16"   # Private Class C
      - "169.254.0.0/16"   # Link-local / Cloud metadata
      - "0.0.0.0/8"        # Current network

    # Limits
    timeout_ms: 30000           # 30 seconds
    max_body_bytes: 1048576     # 1MB response body limit
